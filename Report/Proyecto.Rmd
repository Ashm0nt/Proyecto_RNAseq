---
output:
  pdf_document:
    toc: yes
    toc_depth: 5
    fig_caption: true
    keep_tex: true
    number_sections: true
    latex_engine: xelatex
    includes:
      before_body: portada.tex
fontsize: 11pt
mainfont: Arial
lang: es
header-includes:
  - \usepackage{float}
  - \usepackage{graphicx}
  - \usepackage{geometry}
  - \usepackage{float}
  - \floatplacement{figure}{H}
editor_options: 
  markdown: 
    wrap: 72
bibliography: References.bib
---

# Introducción

La metformina es el tratamiento de primera línea para la diabetes tipo 2 debido a su eficacia para disminuir la gluconeogénesis hepática y mejorar la sensibilidad a la insulina. Además de su acción antihiperglucémica, este fármaco presenta múltiples efectos pleiotrópicos en diversos procesos biológicos, entre ellos la inflamación, el estrés oxidativo, la senescencia celular, la autofagia y la apoptosis, todos estrechamente vinculados con el envejecimiento. Estudios epidemiológicos han sugerido un posible efecto geroprotector de la metformina, asociado con la reducción en la incidencia de enfermedades relacionadas con la edad, como las enfermedades cardiovasculares, distintos tipos de cáncer y padecimientos neurodegenerativos, así como con una disminución de la mortalidad independiente de sus efectos sobre el metabolismo de la glucosa.

El músculo esquelético desempeña un papel central en a homostasis metabólica del organismos y es particularmente suceptible a los cambios asociados al envejeciemiento. La peridad progresiva de masa y función celular, junto con alteraciones en la sensibilidad a la insulina y en la capacidad oxidativa, contribuyen al deterioro de la calidad de vida en adultos mayores. Comprender cómo la metformina modula la biología molecular del músculo esquelético puede aportar unformación clave sobre como los mecanismos mediante los cuaes este fármaco influye en la salud durante el envejecimiento. 


El conjunto de datos analizados en este proyecto se deriva del estudio de Kulkarni et al. (2018) generados a partir de muestras de músculo esquelético y tejido adiposo subcutáneo de adultos de aproximadamente 70 años de edad (n=14). El estudio original se diseñó como un ensayo aleatorizado, doble ciego, controlado con placebo y con esquema cruzado, en el cual los participantes recibieron seis semanas de tratamiento con metformina y seis semanas con placebo.

# Pregunta de investigación 

¿Qué cambios transcriptómicos se observan en el músculo esquelético de adultos mayores después de seis semanas de tratamiento con metformina?

# Análisis

Con la intención de elegir un proyecto disponible en recount3 para realizar un análisis de expresión diferencial, se conuslto la pagina de [recount3](https://rna.recount.bio/). Se eligió el proyecto SRP126485 "Metformin regulates metabolic and nonmetabolic pathways in skeletal muscle and subcutaneous adipose tissues of older adults". 

## Instalación y carga de paquetes

```{r load_packages, message=FALSE, warning=FALSE}

# Instalar Biocmanageer si no está intalado
if (!requireNamespace("BiocManager", quietly = TRUE)) {
    install.packages("BiocManager")
}

# Instalar paquetes de Bioconductor
#BiocManager::install(
#    c(
#        "edgeR", 
#        "ExploreModelMatrix",
#        "limma",
#        "recount3", 
#        "SummarizedExperiment", 
#        "GenomicRanges"
#    )
#)

# Instalar paquetes de CRAN
#install.packages(c(
#    "pheatmap", 
#    "patchwork",
#    "RColorBrewer",
#    "cowplot"
#))

## Cargar los paquetes
library("recount3")
library("SummarizedExperiment")
library("GenomicRanges")
library("limma")
library("edgeR")
library("ExploreModelMatrix")
library("variancePartition")
library("EnhancedVolcano")
library("cowplot")
library("RColorBrewer")
library("pheatmap")
library("ggplot2")

```

## Acceso a los datos
```{r data, message=FALSE, warning=FALSE}
# Cargar proyectos dispobibles en recount3
human_projects <- available_projects()

#Obtener la información del projecto específico
project_info <- subset(human_projects, project == "SRP126485" & project_type == "data_sources")

# Crear un objeto RangedSummarizedExperiment con información a nivel de genes
rse_gene_SRP126485 <- create_rse(project_info)
rse_gene_SRP126485

```

El estudio SRP126485 comprende 100 muestras provenientes de 14 individuos, evaluados en múltiples momentos bajo un diseño cruzado que considera dos condiciones: metformina y placebo. El conjunto de datos abarca mediciones de expresión correspondientes a 63 856 genes.

## Preparación de los datos

```{r trannsform_raw_count, message=FALSE, warning=FALSE}
# Convetir las lecturas por núcleotido a cuentas por lectura 
assay(rse_gene_SRP126485, "counts") <- compute_read_counts(rse_gene_SRP126485)

# Inspeccionar la infromación experimental de cada muestra
rse_gene_SRP126485$sra.sample_attributes[1:15]

# Formatear información del experimento
rse_gene_SRP126485 <-  expand_sra_attributes(rse_gene_SRP126485)
colData(rse_gene_SRP126485)[
    ,
    grepl("^sra_attribute", colnames(colData(rse_gene_SRP126485)))
]


# Filtrar tejido adiposo de músculo esquéletico
keep <- rse_gene_SRP126485$sra_attribute.tissue == "Vastus lateralis muscle"
rse_muscle <- rse_gene_SRP126485[,keep]
table(rse_muscle$sra_attribute.tissue)
dim(rse_muscle)

# Ajustar el tipo de dato de variables categóricas
rse_muscle$sra_attribute.drug <- factor(rse_muscle$sra_attribute.drug)

# Eliminar espacios antes o después del guion
rse_muscle$sra_attribute.source_name <- gsub("\\s*-\\s*", "-", 
                                             rse_muscle$sra_attribute.source_name)

rse_muscle$sra_attribute.source_name <- factor(rse_muscle$sra_attribute.source_name)

## Ajustar factor de drug para que placebo sea el baseline
rse_muscle$sra_attribute.drug <-  relevel(rse_muscle$sra_attribute.drug, "Placebo")


# Confirmar que cada individuo tenga muestras en ambas condiciones (Metformina y placebo)
table(rse_muscle$sra_attribute.subject_id, rse_muscle$sra_attribute.drug)

# Filtrar sujetos que no tengan una condición
keep_subjects <- rse_muscle$sra_attribute.subject_id != "Subject8"
rse_muscle <- rse_muscle[, keep_subjects]
```

 Las muestras correspondientes a músculo esquelético se seleccionaron utilizando la variable `sra_attribute.tissue` contenida en el objeto, conservando únicamente aquellas anotadas como tejido muscular. Durante la inspección del diseño experimental se identificó que uno de los individuos (Subject8) no contaba con muestras en ambas condiciones. Dado que el análisis se basa en comparaciones pareadas dentro de sujeto, este individuo fue excluido para mantener la consistencia del modelo. Además las variables correspondientes al individuo y al tratamiento se codificaron como factores, estableciendo placebo como la categoría de referencia para facilitar la interpretación de los análisis posteriores.

## Control de calidad 

### Profundidad de secuenciación 

```{r sequencing_depth, message=FALSE, warning=FALSE, echo=TRUE}
# Obtener las cuentas
counts <- assay(rse_muscle, "counts")
# Obtener el tamaño de librería
lib_sizes <- colSums(counts)

# Sumary
summary(lib_sizes)

# Crear data frame 
sequencing_depth <- data.frame(
    sample = colnames(rse_muscle),
    lib_size = lib_sizes,
    drug = rse_muscle$sra_attribute.drug,
    subject = rse_muscle$sra_attribute.subject_id,
    source = rse_muscle$sra_attribute.source_name
)

#Graficar 
ggplot(sequencing_depth, aes(x = drug, y = lib_size, fill = drug)) +
  geom_boxplot(outlier.shape = NA) +
  geom_jitter(width = 0.15, alpha = 0.7) +
  labs(
    title = "Library size por tratamiento",
    x = "Tratamiento",
    y = "Número de lecturas"
  ) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(size = 18, face = "bold", hjust = 0.5,
                              color = "#222222"),
    axis.title.y = element_text(size = 13, margin = margin(r = 12)),
    axis.text.x = element_text(size = 13, face = "bold", color = "#222222"),
    axis.text.y = element_text(size = 11, color = "#333333"),
    panel.grid.major.x = element_blank(),
    panel.grid.major.y = element_line(color = "gray85", linewidth = 0.6),
    panel.grid.minor.y = element_line(color = "gray93", linewidth = 0.4),
    legend.position = "none",
    plot.background = element_rect(fill = "white", color = NA),
    panel.border = element_rect(color = "gray80", fill = NA, linewidth = 0.5)
  )

```

La mayoría de las muestras presentaron profundidades de secuenciación dentro del rango esperado para estudios de RNA-seq en humanos (mediana ≈ 16 millones de lecturas). Se identificó una muestra con un tamaño de biblioteca considerablemente menor (~0.9 millones) correspondiente a `Subject7`durante tratamiento placebo. 

### Lecturas asignadas a genes

```{r lectures_genes, message=FALSE, warning=FALSE, echo=TRUE}
# Calcular la proporción de lecturas asignadas a genes
rse_muscle$assigned_gene_prop <-
  rse_muscle$recount_qc.gene_fc_count_all.assigned /
  rse_muscle$recount_qc.gene_fc_count_all.total

# Resumen
summary(rse_muscle$assigned_gene_prop)

#Visualización
df_qc <- data.frame(
  assigned_gene_prop = rse_muscle$assigned_gene_prop
)

ggplot(df_qc, aes(x = assigned_gene_prop)) +
  geom_histogram(bins = 20, color = "black", fill = "#2C7FB8") +
  theme_bw() +
  labs(
    title = "Proporción de lecturas asignadas a genes",
    x = "Fracción de lecturas",
    y = "Número de muestras"
  )

#Filtrar muestras con pocas lescturas asignadas
rse_muscle_filtered <- rse_muscle[,rse_muscle$assigned_gene_prop > 0.3]

# Filtrar sujetos
tab <- table(rse_muscle_filtered$sra_attribute.subject_id,
             rse_muscle_filtered$sra_attribute.drug)

# Sujetos con ambas condiciones
complete_subjects <- rownames(tab)[rowSums(tab > 0) == 2]

rse_muscle_filtered <- rse_muscle_filtered[,
  rse_muscle_filtered$sra_attribute.subject_id %in% complete_subjects
]

table(rse_muscle_filtered$sra_attribute.subject_id, rse_muscle_filtered$sra_attribute.drug)
```

Se eliminaron los sujetos 5 y 14 debido a que tras el filtrado no contaban con muestras en ambas condiciones.


### Filtrado de genes 

```{r}
# Obtener counts
counts_muscle_filtered <- assay(rse_muscle_filtered, "counts")

# Crear DGEList primero
dge <- DGEList(counts = counts_muscle_filtered, genes = rowData(rse_muscle_filtered))

# Crear metadata correctamente
meta <- data.frame(
  group   = factor(rse_muscle_filtered$sra_attribute.drug),
  subject = factor(rse_muscle_filtered$sra_attribute.subject_id),
  visit   = factor(rse_muscle_filtered$sra_attribute.source_name)
)

# IMPORTANTE: rownames deben coincidir con columnas de counts
rownames(meta) <- colnames(dge)

# Diseño para filtrado
design <- model.matrix(~ group, meta)

# Filtrar genes
keep_genes <- filterByExpr(dge, design = design)
dge <- dge[keep_genes, , keep.lib.sizes = FALSE]

#Obtener nombres de genes filtrados
gene_info <- as.data.frame(rowData(rse_muscle_filtered))
gene_info_filtered <- gene_info[keep_genes, ]

dge$genes <- data.frame(
  ENSEMBL = rownames(dge),
  SYMBOL  = gene_info_filtered$gene_name
)

# Número de genes filtrados
num_genes_retenidos <- sum(keep_genes)
num_genes_totales <- nrow(counts_muscle_filtered)

# Porcentaje de genes retenidos
porcentaje_genes <- (num_genes_retenidos / num_genes_totales) * 100

cat("Genes retenidos:", num_genes_retenidos, "\n")
cat("Total de genes:", num_genes_totales, "\n")
cat(sprintf("Porcentaje de genes retenidos: %.2f%%\n", porcentaje_genes))
```


### Exploración de varianza

```{r}

colores <- c("#3dd0eeff", "#FF7F7F")
plotMDS(dge, 
        col = colores[as.numeric(meta$group)],
        pch = 16,
        cex = 1.5,
        main = "MDS por tratamiento",
        xlab = "Dimensión 1",
        ylab = "Dimensión 2")

# Añadir leyenda mejorada
legend("topright", 
       legend = levels(meta$group),
       col = colores[1:length(levels(meta$group))], 
       pch = 16,
       cex = 0.8,
       title = "Tratamiento",
       bty = "o",           # Con borde
       bg = "white",        # Fondo blanco
       box.lwd = 1)         # Grosor del borde
```

El análisis de escalamiento multidimensional (MDS) no mostró una separación evidente entre las condiciones de metformina y placebo en los primeros componentes principales. Dado que el MDS sugiere la presencia de múltiples fuentes de variabilidad en los datos, se procedió a realizar un análisis de partición de varianza mediante modelos lineales mixtos para cuantificar formalmente la contribución relativa del sujeto y del tratamiento a la variación transcriptómica observada.

```{r}
form_vp <- ~ (1|group) + (1|subject) + (1|visit)
vobj <- voomWithDreamWeights(dge, form_vp, meta, BPPARAM = param)
vp <- fitExtractVarPartModel(vobj, form_vp, meta, BPPARAM = param)
plotVarPart(vp)
```


Para evaluar la contribución de las variables experimentales a la varianza global de los datos de expresión génica, se realizó un análisis de partición de la varianza. El factor 'subject' (sujeto) emergió como una fuente significativa de variación, explicando una proporción sustancial de la varianza en un gran número de genes, lo que justifica su inclusión en el modelo lineal para controlar la heterogeneidad interindividual. Por el contrario, las variables 'group' (grupo) y 'visit' (visita) mostraron una contribución marginal a la varianza total en la mayoría de los genes. Cabe destacar que se observó una fracción elevada de varianza residual, lo que sugiere la presencia de ruido técnico o biológico no capturado por el diseño inicial, subrayando la importancia de emplear métodos robustos de normalización y filtrado antes del análisis de expresión diferencial


### Análisis de expresión diferencial

```{r}
form_de <- ~ group + (1|subject)
param <- SerialParam(progressbar = TRUE)
vobj_de <- voomWithDreamWeights(dge, form_de, meta, BPPARAM = param, plot=TRUE)
fit <- dream(vobj_de, form_de, meta, BPPARAM = param)
fit <- eBayes(fit)
res <- topTable(fit, coef = "groupMetformin", number = Inf, sort.by = "P")
head(res)
```

#### MA plot
```{r}

df <- data.frame(
  AveExpr = res$AveExpr,
  logFC = res$logFC,
  P = res$P.Value,
  FDR = res$adj.P.Val
)

df$Significant <- df$FDR < 0.05

ggplot(df, aes(AveExpr, logFC)) +
  
  # No significativos
  geom_point(data = subset(df, Significant == FALSE),
             color = "grey75",
             alpha = 0.5,
             size = 1) +
  
  # Significativos encima
  geom_point(data = subset(df, Significant == TRUE),
             color = "#ff3c3cff", 
             alpha = 0.9,
             size = 1.3) +
  
  # Línea central
  geom_hline(yintercept = 0,
             color = "black",
             linewidth = 0.6) +
  
  # Umbral biológico ±1
  geom_hline(yintercept = c(-1,1),
             linetype = "dashed",
             color = "black",
             linewidth = 0.4) +
  
  theme_classic(base_size = 14) +
  labs(title = "MA Plot: Metformin vs Placebo",
       x = "Average log-expression",
       y = "Log2 Fold Change") +
  theme(legend.position = "none")
```

En el MA plot se observa que la mayoría de los genes significativamente expresados (FDR < 0.05) presentan cambios moderados en la expresión (logFC entre -1 y 1). Esto sugiere que, aunque existen diferencias estadísticamente significativas, la respuesta al tratamiento con metformina en músculo esquelético no es masiva, sino que se manifiesta como ajustes finos y moderados en la expresión génica.

Además, se aprecia una alta densidad de genes significativos en el rango de baja expresión (lado izquierdo del gráfico). La distribución simétrica de genes regulados positivamente y negativamente indica un impacto equilibrado sobre la homeostasis celular del músculo esquelético. Cabe destacar que se identificaron DEGs a lo largo de un amplio espectro de niveles de abundancia, lo que subraya la eficacia del filtrado y la normalización empleados para detectar cambios sutiles pero consistentes estadísticamente. 


Dado que se trata de la respuesta a un tratamiento y considerando la variabilidad individual observada, los genes regulados positiva y negativamente (UP y DOWN) se consideraron con un umbral más bajo de logFC ≥ 0.5, siguiendo la misma estrategia aplicada en el artículo de referencia

```{r}
# Volcanoplot

res$Category <- "NS"

# Primero los verdaderamente DE
res$Category[res$logFC > 0.5 & res$adj.P.Val < 0.05] <- "UP"
res$Category[res$logFC < -0.5 & res$adj.P.Val < 0.05] <- "DOWN"

# Luego los parciales
res$Category[abs(res$logFC) > 0.5 & res$adj.P.Val >= 0.05] <- "logFC"
res$Category[abs(res$logFC) <= 0.5 & res$adj.P.Val < 0.05] <- "p-value"


keyvals <- c(
  NS = "grey85",
  logFC = "#e0d688ff",
  `p-value` = "#a186c4ff",
  UP = "#FF7F7F",
  DOWN = "#3dd0eeff"
)

colCustom <- keyvals[res$Category]


# R
EnhancedVolcano(
  res,
  lab = ifelse(is.na(res$SYMBOL) | res$SYMBOL == "", rownames(res), res$SYMBOL),
  x = "logFC",
  y = "adj.P.Val",
  xlim = c(-2, 2),
  ylim = c(0, 5.5),
  ylab = expression(-Log[10]~adj~P),
  pCutoff = 0.05,
  FCcutoff = 0.5,
  selectLab = c("PDK4", "TAS2R46", "SLC1A1", "HLA-DOA", "HOXD4", "BEX4", "CCL5", "RNF43", "GAPDHP42", "HRASLS5", "PPARGC1A", "SLC2A4", "PCK1", "RET", "RBBP8", "RPS6KA6", "ANGPT2", "SLC38A9", "GRAMD1B", "THBD", "RARRES3", "AFMID"),
  xlab = bquote(~Log[2]~ 'fold change'),
  labSize = 3.5,
  labCol = "black",
  labFace = "bold",
  boxedLabels = TRUE,
  drawConnectors = TRUE,
  widthConnectors = 0.5,
  colConnectors = "black",
  cutoffLineType = "twodash",
  pointSize = 2.5,
  colCustom = colCustom,
  cutoffLineWidth = 0.8,
  title = "Metformin vs Placebo",
  subtitle = "Expresión diferencial en músculo esquelético",
  caption = paste0(sum(res$Category == "UP"), " upregulated; ",
                   sum(res$Category == "DOWN"), " downregulated")
)
```

```{r}
# Guardar resultados 
UP_genes   <- res[res$Category == "UP", ]
DOWN_genes <- res[res$Category == "DOWN", ]
FDR_only <- res[res$Category == "p-value", ]

nrow(UP_genes)
nrow(DOWN_genes)
nrow(FDR_only)
```

El análisis de expresión diferencial, visualizado mediante un Volcano Plot, identificó un total de 396 genes significativamente regulados por la metformina bajo un umbral de $|Log_2FC| > 0.5$ y $FDR < 0.05$ (130 incrementados y 266 disminuidos). Además, se identificaron 525 genes adicionales que alcanzaron significancia estadística ($FDR < 0.05$) con magnitudes de cambio menores, sugiriendo una modulación transcriptómica extensa pero sutil. Entre los genes con mayor significancia y magnitud destacan PDK4, SLC1A1, CCL5 y HLA-DOA. La robustez de estos hallazgos, a pesar de la heterogeneidad interindividual, valida la sensibilidad del modelo de efectos mixtos para capturar la firma molecular de la metformina en tejido muscular humano


```{r}

n_top <- 25

top_up <- UP_genes[order(UP_genes$adj.P.Val), ][1:n_top, ]
top_down <- DOWN_genes[order(DOWN_genes$adj.P.Val), ][1:n_top, ]

selected_genes <- rbind(top_up, top_down)

# Extraer expresión normalizada
heatmap_data <- vobj_de$E[rownames(selected_genes), ]

rownames(heatmap_data) <- res[rownames(selected_genes), "SYMBOL"]

# Anotación de genes
gene_annotation <- data.frame(
  Regulation = ifelse(selected_genes$logFC > 0, "Up", "Down"),
  row.names = rownames(heatmap_data)
)

# Anotación de muestras
sample_annotation <- data.frame(
  Treatment = meta$group,
  Visits = meta$visit
)
rownames(sample_annotation) <- colnames(heatmap_data)

# Ordenar filas por logFC (Up primero, Down después)
heatmap_data <- heatmap_data[order(selected_genes$logFC, decreasing = TRUE), ]

# Plot con colores por defecto
pheatmap(
  heatmap_data,
  scale = "row",
  clustering_method = "ward.D2",
  annotation_row = gene_annotation,
  annotation_col = sample_annotation,
  main = paste("Top", n_top, "up y", n_top, "down genes"),
  fontsize_row = 8,
  fontsize_col = 10
)
```

Finalmente, el análisis de agrupamiento jerárquico (Heatmap) de los 50 genes con mayor varianza estadística reveló patrones de expresión consistentes con la acción de la metformina, logrando distinguir bloques de regulación positiva y negativa bien definidos. Si bien el dendrograma de muestras reflejó la predominancia de la variabilidad interindividual —confirmando los hallazgos del análisis de partición de varianza—, los genes seleccionados mostraron una respuesta coordinada al tratamiento. Marcadores como PDK4, AFMID y THBD exhibieron perfiles de expresión contrastantes entre condiciones, sugiriendo que la metformina induce una reprogramación metabólica específica en el músculo esquelético que trasciende el ruido biológico basal de los sujetos.


#### Análisis de varianza para los genes más significativos

```{r}
# Filtrar los genes up y down
vp_up <- vp[rownames(vp) %in% rownames(top_up), ]
vp_down <- vp[rownames(vp) %in% rownames(top_down), ]

geneNames_up <- top_up$SYMBOL[match(rownames(vp_up), rownames(top_up))]
geneNames_down <- top_down$SYMBOL[match(rownames(vp_down), rownames(top_down))]

# Reemplazar rownames en vp_up y vp_down
rownames(vp_up) <- geneNames_up
rownames(vp_down) <- geneNames_down

effect <- "group"
vp_up_sorted <- vp_up[order(vp_up[, effect], decreasing = TRUE), ]
vp_down_sorted <- vp_down[order(vp_down[, effect], decreasing = TRUE), ]

# Graficar barras porcentuales
plotPercentBars(vp_up_sorted) + ggtitle("Estructura de varianza - TOP Genes UP")
plotVarPart(vp_up) + ggtitle("Estructura de varianza - Genes UP")
```

Al contrastar la estructura de varianza de los genes upregulated con la tendencia global del transcriptoma, se observa un enriquecimiento sustancial en la proporción de varianza explicada por el tratamiento (group). Mientras que a nivel genómico el impacto de la metformina es sutil, en el conjunto de genes UP este factor llega a explicar hasta el 30% de la variabilidad total. Esta reducción proporcional de la varianza residual, junto con la persistencia de un componente de sujeto (subject) estable, sugiere que estos genes representan una respuesta biológica robusta y consistente a través de la cohorte de adultos mayores, permitiendo que la señal del fármaco trascienda la heterogeneidad interindividual basal


```{r}
plotPercentBars(vp_down_sorted) + ggtitle("Estructura de varianza - TOP Genes DOWN")
plotVarPart(vp_down) + ggtitle("Estructura de varianza - Genes DOWN")
```

El análisis de la estructura de varianza para los genes con regulación negativa (DOWN) ratificó la eficacia del modelo para aislar la señal del tratamiento frente a la heterogeneidad biológica. Se observó que el factor group explica una proporción sustancial de la variabilidad (mediana ~18%), un incremento drástico frente al nivel genómico basal. Notablemente, el componente subject mostró una influencia predominante en este conjunto, sugiriendo que la magnitud de la inhibición génica inducida por la metformina está íntimamente ligada al perfil individual de cada adulto mayor. La marcada contracción de la varianza residual en estos genes valida que los cambios identificados en vías de inflamación y remodelado de la matriz extracelular son estadísticamente robustos y representan una respuesta farmacológica genuina.

#### MDS 

```{r}
genes_sel <- c(rownames(top_up), rownames(top_down))
expr_sel <- vobj$E[genes_sel, ]

plotMDS(expr_sel, 
        col = colores[as.numeric(meta$group)],
        pch = 16,
        cex = 1.5,
        main = "MDS por tratamiento",
        xlab = "Dimensión 1",
        ylab = "Dimensión 2")

# Añadir leyenda mejorada
legend("bottomleft", 
       legend = levels(meta$group),
       col = colores[1:length(levels(meta$group))], 
       pch = 16,
       cex = 0.8,
       title = "Tratamiento",
       bty = "o",           # Con borde
       bg = "white",        # Fondo blanco
       box.lwd = 1)         # Grosor del borde
```

La eficacia de la firma transcriptómica identificada se confirmó mediante un análisis de escalamiento multidimensional (MDS) restringido a los genes diferencialmente expresados. A diferencia del análisis global, este modelo logró explicar el 57% de la varianza total, con un 45% concentrado en la primera dimensión, la cual separa de manera efectiva las muestras tratadas con metformina de aquellas que recibieron placebo. Este incremento sustancial en la varianza explicada demuestra que, si bien la variabilidad interindividual es elevada, la metformina induce cambios coordinados y consistentes en un conjunto específico de genes metabólicos y estructurales, permitiendo una clara distinción molecular entre las condiciones experimentales.

### Interpretación de resultados

#### GENES UPREGULATED

| Gen | Producto | Función |
|-----|----------|---------|
|  CHMP1B-AS1 | lncRNA antisense de CHMP1B |   Regulación del gen CHMP1B, posible modulación del tráfico endosómico, degradación de proteínas, secreción de vesículas; potencial impacto en proliferación o apoptosis     |
|   PDK4  |    Piruvato deshidrogenasa quinasa 4 (enzima)      |    Fosforila e inhibe el complejo piruvato deshidrogenasa (PDH), reduciendo la conversión de piruvato a acetil-CoA; promueve el metabolismo de ácidos grasos sobre glucosa. Mecanismo adaptativo de flexibilidad metabólica    |
|  DYNC2LI1    |      Dynein Cytoplasmic 2 Light Intermediate Chain 1 (proteína, subunidad ligera-intermedia de dineína 2)    |   Parte del complejo dineína 2 que participa en transporte retrógrado intraflagelar (IFT), moviendo proteínas desde el extremo distal del cilio hacia la base. Podría mejorar el transporte de receptores y señalización celular dependiente de cilios, contribuyendo a la adaptación metabólica a metformina      |
|   RBBP8  |      Retinoblastoma Binding Protein 8 (proteína, también llamada CtIP)    |     Participa en reparación de ADN por recombinación homóloga, resectando extremos de ADN en daños de doble cadena; también regula progresión del ciclo celular en fase S/G2    |
|   RPS6KA6  |     Ribosomal Protein S6 Kinase A6 (RSK4, serina/treonina quinasa)     |    Quinasa dependiente de MAPK, regula proliferación, diferenciación, supervivencia celular, y puede inhibir el crecimiento celular; también se ha vinculado con regulación de metabolismo energético     |
|   NACA2  |    Nascent Polypeptide-Associated Complex Subunit Alpha 2      |    Se une a polipéptidos nacientes que no son secretorios mientras emergen del ribosoma, evitando su destino inapropiado al ER. Bloquea la interacción con la Signal Recognition Particle (SRP) y reduce la afinidad de los ribosomas por sitios de translocación en la membrana del ER (M sites). Previene agregación y asegura el correcto plegamiento y destino de proteínas   |
|   ANGPT2  |     Angiopoietin 2 (proteína secretada)     |     Ligando de los receptores Tie2 en células endoteliales. Regula angiogénesis, remodelación vascular y permeabilidad endotelial. Puede antagonizar ANGPT1-Tie2 para promover desestabilización vascular y favorecer remodelado bajo estrés o crecimiento    |
|   BMP6  |   Bone Morphogenetic Protein 6 (proteína secretada, factor de crecimiento TGF-β)       |   Regula diferenciación ósea y adipogénica, metabolismo del hierro, angiogénesis y homeostasis celular; activa vías SMAD dependientes      |
|   OSTM1  |     Osteopetrosis Associated Transmembrane Protein 1     |     Subunidad reguladora de la ClC-7 necesaria para acidificación lisosomal y función de osteoclastos; participa en homeostasis lisosomal, degradación de proteínas y transporte de iones    |
| SEC11C | Signal Peptidase Complex Subunit SEC11C | Subunidad del complejo peptidasa de señal, que corta péptidos señal de proteínas nacientes durante su translocación al retículo endoplásmico (ER); esencial para maduración de proteínas secretadas |
| TAS2R46 |  Taste receptor type 2 member 46 (receptor GPCR)| Receptor acoplado a proteína G (GPCR) sensible a compuestos amargos. Participa en señalización intracelular, incluyendo rutas de calcio y cAMP; se expresa también fuera de la lengua, en células metabólicas y endoteliales | 
| SLC38A9 |  Solute Carrier Family 38 Member 9 (transceptor de aminoácidos, transportador de arginina/lisina) |  Actúa como sensor y transportador de aminoácidos en lisosomas, regulando la vía mTORC1; permite que el complejo Rag GTPasa detecte nutrientes y ajuste el crecimiento y metabolismo|


La firma molecular identificada en este estudio posiciona a la metformina como un agente de resiliencia metabólica en el músculo esquelético del adulto mayor. Un hallazgo central es la regulación positiva de PDK4, que en conjunto con el sensor de aminoácidos lisosomal SLC38A9, señala una restauración de la flexibilidad metabólica; la capacidad de alternar eficientemente entre sustratos energéticos es una facultad que declina con la edad y cuya pérdida subyace a la fragilidad muscular. Esta reprogramación se complementa con la modulación de quinasas y reguladores del ciclo celular como RPS6KA6 (RSK4) y RBBP8, sugiriendo una optimización de las vías de supervivencia y reparación del ADN frente al daño acumulado por el envejecimiento.

Particularmente relevante para el contexto geriátrico es el fortalecimiento de los mecanismos de proteostasis y control de calidad celular. La sobreexpresión de genes como NACA2, SEC11C y OSTM1 indica una mejora en la fidelidad de la síntesis proteica y en la eficiencia de la degradación lisosomal. Estos procesos son críticos, ya que la acumulación de proteínas mal plegadas y la disfunción autofágica son motores primarios de la sarcopenia. Asimismo, la identificación de CHMP1B-AS1 y DYNC2LI1 apunta a una regulación sofisticada del tráfico vesicular y la señalización mediada por cilios, mecanismos emergentes en la adaptación metabólica celular.

Finalmente, la regulación de factores secretados y de señalización intercelular, como ANGPT2, BMP6 y el receptor extra-gustativo TAS2R46, sugiere una mejora en el microambiente tisular que abarca desde la remodelación vascular hasta la homeostasis del hierro y la comunicación paracrina. En conjunto, estos resultados demuestran que el impacto de la metformina trasciende el control glucémico convencional, actuando como un geroprotector integral capaz de intervenir en los pilares del mantenimiento celular necesarios para preservar la funcionalidad física y la autonomía en la vejez.



### GENES DOWNREGULATED

| Gen | Producto | Función |
|-----|----------|---------|
| GRAMD1B| GRAM domain-containing protein 1B| Proteína de membrana que regula transporte de colesterol y lípidos entre retículo endoplásmico y membrana plasmática, manteniendo homeostasis lipídica y señalización. Podría significar un ajuste del metabolismo lipídico, disminuyendo transporte de lípidos hacia la membrana y favoreciendo rutas de catabolismo de energía  | 
| WNT11 | Wnt family member 11 (proteína secretada, señalización no canónica) | Señalización no canónica Wnt que regula morfogénesis, polaridad celular, migración y remodelado citosquelético; contribuye a diferenciación celular y desarrollo vascular.Ajuste selectivo del remodelado celular, reduciendo migración y reorganización activa del citosqueleto, |
| GP1BA | Glycoprotein Ib platelet subunit alpha |  Subunidad alfa del receptor GP Ib-IX-V; participa en adhesión plaquetaria, señalización y hemostasia, interactuando con factor de von Willebrand |
| COL3A1 |  Collagen type III alpha 1 chain (proteína estructural ECM) |Componente de la matriz extracelular, aporta elasticidad y soporte estructural a vasos sanguíneos, piel y tejido conectivo; participa en remodelado tisular y señalización mecánica. La disminución tras metformina podría reflejar reducción del remodelado ECM activo | 
| THBD |  Thrombomodulin (proteína transmembrana endotelial) | Receptor transmembrana que se une a trombina, activando proteína C anticoagulante; regula coagulación, inflamación y homeostasis vascular. modulación del microambiente vascular y reducción de estrés hemostático en respuesta a cambios metabólicos |
| RARRES3 | Retinoic acid receptor responder protein 3  |  Proteína inducida por retinoides que regula diferenciación celular, señalización antiproliferativa y homeostasis de membranas lipídicas; puede tener efectos en estrés celular y control de crecimiento. Refleja reducción de señales de diferenciación o estrés celular no prioritario|  
| AFMID | Arylformamidase |  Enzima que cataliza un paso en la vía de degradación del triptófano hacia la niacinamida y NAD⁺, modulando metabolismo energético y estrés oxidativo| 
| NLRP3 |NLR family pyrin domain containing 3 (inflammasoma)  | Sensor citosólico que forma el inflammasoma NLRP3, activando caspasa-1, maduración de IL-1β/IL-18 y respuesta inflamatoria |
|  HLA-DOA | Major histocompatibility complex, class II, DO alpha | Subunidad alfa de HLA-DO, que regula la presentación de antígenos por HLA clase II, modulando la carga de péptidos en células presentadoras de antígeno. Rducción de activación inmune adaptativa local | 
| RASSF2 | Ras association domain family member 2 | Proteína supresora de tumores que regula Ras-MAPK, apoptosis y ciclo celular; modula respuesta a estrés y control de proliferación|
| HOXD4 | Homeobox D4 | Factor de transcripción de la familia HOX, regula desarrollo, diferenciación celular y expresión génica específica de tejidos |
| APOL1 | Apolipoprotein L1 |  Proteína implicada en transporte de lípidos, defensa contra patógenos y regulación de estrés oxidativo en células| 
| CD3EAP| CD3e molecule associated protein |  Participa en transcripción ribosomal, regulación de proliferación y control del ciclo celular; asociado a la síntesis de ARN ribosomal y ensamblaje ribosomal|


La respuesta de inhibición génica observada tras el tratamiento con metformina revela una desactivación coordinada de procesos patológicos intrínsecos al envejecimiento muscular. Esta «firma de apagado» se manifiesta, en primera instancia, a través de la atenuación del inflammaging y una profunda reprogramación inmune; la regulación a la baja de sensores críticos del inflammasoma, como NLRP3, y de moléculas de presentación de antígenos, como HLA-DOA, sugiere una pacificación del microambiente inmunológico que protege al tejido del daño colateral provocado por una respuesta inmune local crónicamente sobreactivada. Complementariamente, se identifica un control estricto sobre la dinámica de la matriz extracelular (ECM), evidenciado por la reducción de componentes estructurales como COL3A1 y mediadores de remodelado citosquelético como WNT11. Dado que el envejecimiento muscular se asocia con un proceso de fibro-sustitución que compromete la potencia y elasticidad, la disminución de estos genes sugiere que la metformina actúa frenando la expansión de la red fibrótica y preservando la integridad arquitectónica del tejido.

Asimismo, la inhibición de reguladores del transporte lipídico, representados por GRAMD1B y APOL1, apunta a una recalibración del metabolismo de lípidos y de la homeostasis de membranas. Este ajuste es fundamental en adultos mayores para mejorar la fluidez de la membrana plasmática y optimizar la señalización de receptores metabólicos, como el de la insulina, frecuentemente entorpecida por la acumulación lipídica ectópica. Finalmente, el descenso en la expresión de factores de transcripción y reguladores del ciclo celular, tales como HOXD4 y RASSF2, sugiere una transición hacia un estado de «quietud metabólica» y ahorro energético. Al desactivar programas de diferenciación y proliferación potencialmente ineficientes en un contexto de senescencia, el fármaco parece redirigir los recursos celulares hacia mecanismos de mantenimiento, reparación y resiliencia proteica. En conjunto, esta respuesta negativa no representa una pérdida de función, sino una intervención geroprotectora dual que desactiva las rutas de inflamación y rigidez estructural para restaurar un perfil molecular más saludable y funcional.


## CONCLUSIÓN

El presente estudio demuestra que el tratamiento con metformina en adultos mayores induce una reprogramación transcriptómica integral en el músculo esquelético, orientada hacia la restauración de la homeostasis celular y la resiliencia metabólica. Mediante la aplicación del modelo de efectos mixtos dream, fue posible discernir una firma molecular robusta a pesar de la elevada heterogeneidad interindividual propia de la población geriátrica. El análisis de la estructura de varianza confirmó la solidez de estos hallazgos: mientras que a nivel genómico global el efecto del tratamiento es sutil, en los genes identificados el factor group (metformina vs. placebo) logró explicar entre el 15% y el 30% de la variabilidad total, superando significativamente al ruido residual.

Esta respuesta se caracteriza por una acción dual geroprotectora claramente diferenciada en su arquitectura de varianza. Por un lado, la activación de mecanismos críticos de proteostasis, flexibilidad metabólica y reparación celular —liderada por genes como PDK4 y NACA2— mostró una respuesta altamente consistente entre sujetos. Por otro lado, se observó una desactivación coordinada de procesos deletéreos como la inflamación crónica (inflammaging) y la fibrosis tisular —mediada por la represión de NLRP3 y COL3A1—, cuya magnitud de inhibición estuvo íntimamente ligada al perfil basal de cada individuo, evidenciando una modulación personalizada del microambiente muscular.

En conjunto, estos hallazgos posicionan a la metformina no solo como un agente hipoglucemiante, sino como una intervención terapéutica capaz de mitigar múltiples pilares del envejecimiento biológico. Al demostrar una capacidad única para "limpiar" la señal del fármaco frente al ruido del envejecimiento, este estudio ofrece una base molecular sólida para el uso de la metformina en la preservación de la función muscular y la prevención de la fragilidad en la vejez.