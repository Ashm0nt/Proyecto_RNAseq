---
output:
  pdf_document:
    toc: yes
    toc_depth: 5
    fig_caption: true
    keep_tex: true
    number_sections: true
    latex_engine: xelatex
    includes:
      before_body: portada.tex
fontsize: 11pt
mainfont: Arial
lang: es
header-includes:
  - \usepackage{float}
  - \usepackage{graphicx}
  - \usepackage{geometry}
  - \usepackage{float}
  - \floatplacement{figure}{H}
editor_options: 
  markdown: 
    wrap: 72
bibliography: References.bib
---

# Introducción

La metformina es el tratamiento de primera línea para la diabetes tipo 2 debido a su eficacia para disminuir la gluconeogénesis hepática y mejorar la sensibilidad a la insulina. Además de su acción antihiperglucémica, este fármaco presenta múltiples efectos pleiotrópicos en diversos procesos biológicos, entre ellos la inflamación, el estrés oxidativo, la senescencia celular, la autofagia y la apoptosis, todos estrechamente vinculados con el envejecimiento. Estudios epidemiológicos han sugerido un posible efecto geroprotector de la metformina, asociado con la reducción en la incidencia de enfermedades relacionadas con la edad, como las enfermedades cardiovasculares, distintos tipos de cáncer y padecimientos neurodegenerativos, así como con una disminución de la mortalidad independiente de sus efectos sobre el metabolismo de la glucosa.

El músculo esquelético desempeña un papel central en a homostasis metabólica del organismos y es particularmente suceptible a los cambios asociados al envejeciemiento. La peridad progresiva de masa y función celular, junto con alteraciones en la sensibilidad a la insulina y en la capacidad oxidativa, contribuyen al deterioro de la calidad de vida en adultos mayores. Comprender cómo la metformina modula la biología molecular del músculo esquelético puede aportar unformación clave sobre como los mecanismos mediante los cuaes este fármaco influye en la salud durante el envejecimiento. 


El conjunto de datos analizados en este proyecto se deriva del estudio de Kulkarni et al. (2018) generados a partir de muestras de músculo esquelético y tejido adiposo subcutáneo de adultos de aproximadamente 70 años de edad (n=14). El estudio original se diseñó como un ensayo aleatorizado, doble ciego, controlado con placebo y con esquema cruzado, en el cual los participantes recibieron seis semanas de tratamiento con metformina y seis semanas con placebo.

# Pregunta de investigación 

¿Qué cambios transcriptómicos se observan en el músculo esquelético de adultos mayores después de seis semanas de tratamiento con metformina?

# Análisis

Con la intención de elegir un proyecto disponible en recount3 para realizar un análisis de expresión diferencial, se conuslto la pagina de [recount3](https://rna.recount.bio/). Se eligió el proyecto SRP126485 "Metformin regulates metabolic and nonmetabolic pathways in skeletal muscle and subcutaneous adipose tissues of older adults". 

## Instalación y carga de paquetes

```{r load_packages, message=FALSE, warning=FALSE}

# Instalar Biocmanageer si no está intalado
if (!requireNamespace("BiocManager", quietly = TRUE)) {
    install.packages("BiocManager")
}

# Instalar paquetes de Bioconductor
#BiocManager::install(
#    c(
#        "edgeR", 
#        "ExploreModelMatrix",
#        "limma",
#        "recount3", 
#        "SummarizedExperiment", 
#        "GenomicRanges"
#    )
#)

# Instalar paquetes de CRAN
#install.packages(c(
#    "pheatmap", 
#    "patchwork",
#    "RColorBrewer",
#    "cowplot"
#))

## Cargar los paquetes
library("recount3")
library("SummarizedExperiment")
library("GenomicRanges")
library("limma")
library("edgeR")
library("ExploreModelMatrix")
library("cowplot")
library("RColorBrewer")
library("pheatmap")

```

## Acceso a los datos
```{r data, message=FALSE, warning=FALSE}
# Cargar proyectos dispobibles en recount3
human_projects <- available_projects()

#Obtener la información del projecto específico
project_info <- subset(human_projects, project == "SRP126485" & project_type == "data_sources")

# Crear un objeto RangedSummarizedExperiment con información a nivel de genes
rse_gene_SRP126485 <- create_rse(project_info)
rse_gene_SRP126485

```

El estudio SRP126485 comprende 100 muestras provenientes de 14 individuos, evaluados en múltiples momentos bajo un diseño cruzado que considera dos condiciones: metformina y placebo. El conjunto de datos abarca mediciones de expresión correspondientes a 63 856 genes.

## Preparación de los datos

```{r trannsform_raw_count, message=FALSE, warning=FALSE}
# Convetir las lecturas por núcleotido a cuentas por lectura 
assay(rse_gene_SRP126485, "counts") <- compute_read_counts(rse_gene_SRP126485)

# Inspeccionar la infromación experimental de cada muestra
rse_gene_SRP126485$sra.sample_attributes[1:15]

# Formatear información del experimento
rse_gene_SRP126485 <-  expand_sra_attributes(rse_gene_SRP126485)
colData(rse_gene_SRP126485)[
    ,
    grepl("^sra_attribute", colnames(colData(rse_gene_SRP126485)))
]

# Filtrar tejido adiposo de músculo esquéletico
keep <- rse_gene_SRP126485$sra_attribute.tissue == "Vastus lateralis muscle"
rse_muscle <- rse_gene_SRP126485[,keep]
table(rse_muscle$sra_attribute.tissue)
dim(rse_muscle)

# Confirmar que cada individuo tenga muestras en ambas condiciones (Metformina y placebo)
table(rse_muscle$sra_attribute.subject_id, rse_muscle$sra_attribute.drug)

# Filtrar sujetos que no tengan una condición
keep_subjects <- rse_muscle$sra_attribute.subject_id != "Subject8"
rse_muscle <- rse_muscle[, keep_subjects]

# Ajustar el tipo de dato de variables categóricas
rse_muscle$sra_attribute.drug <- factor(rse_muscle$sra_attribute.drug)

## Ajustar factor de drug para que placebo sea el baseline
rse_muscle$sra_attribute.drug <-  relevel(rse_muscle$sra_attribute.drug, "Placebo")

rse_muscle$sra_attribute.subject_id <- factor(rse_muscle$sra_attribute.subject_id)
rse_muscle$sra_attribute.source_name <- factor(rse_muscle$sra_attribute.source_name)

```

 Las muestras correspondientes a músculo esquelético se seleccionaron utilizando la variable `sra_attribute.tissue` contenida en el objeto, conservando únicamente aquellas anotadas como tejido muscular. Durante la inspección del diseño experimental se identificó que uno de los individuos (Subject8) no contaba con muestras en ambas condiciones. Dado que el análisis se basa en comparaciones pareadas dentro de sujeto, este individuo fue excluido para mantener la consistencia del modelo. Además las variables correspondientes al individuo y al tratamiento se codificaron como factores, estableciendo placebo como la categoría de referencia para facilitar la interpretación de los análisis posteriores.

